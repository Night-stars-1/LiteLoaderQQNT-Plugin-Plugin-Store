var Ce=Object.create;var ee=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var Oe=Object.getPrototypeOf,_e=Object.prototype.hasOwnProperty;var ye=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var Re=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ne(e))!_e.call(o,i)&&i!==t&&ee(o,i,{get:()=>e[i],enumerable:!(n=Se(e,i))||n.enumerable});return o};var v=(o,e,t)=>(t=o!=null?Ce(Oe(o)):{},Re(e||!o||!o.__esModule?ee(t,"default",{value:o,enumerable:!0}):t,o));var oe=ye((Me,se)=>{var w=require("fs"),be=require("util"),b=require("path"),j=require("events"),te=require("zlib"),re=require("stream"),s={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSIGFIRST:80,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,MAXFILECOMMENT:65535,ENDL64HDR:20,ENDL64SIG:117853008,ENDL64SIGFIRST:80,ENDL64OFS:8,END64HDR:56,END64SIG:101075792,END64SIGFIRST:80,END64SUB:24,END64TOT:32,END64SIZ:40,END64OFF:48,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,FLG_ENC:0,FLG_COMP1:1,FLG_COMP2:2,FLG_DESC:4,FLG_ENH:8,FLG_STR:16,FLG_LNG:1024,FLG_MSK:4096,FLG_ENTRY_ENC:1,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535},y=function(o){let e,t,n,i,a,d,E=this,C=o.storeEntries!==!1?{}:null,de=o.file,pe=o.nameEncoding?new TextDecoder(o.nameEncoding):null;me();function me(){o.fd?(e=o.fd,W()):w.open(de,"r",(r,c)=>{if(r)return E.emit("error",r);e=c,W()})}function W(){w.fstat(e,(r,c)=>{if(r)return E.emit("error",r);t=c.size,n=o.chunkSize||Math.round(t/1e3),n=Math.max(Math.min(n,Math.min(128*1024,t)),Math.min(1024,t)),Le()})}function F(r,c){if(r||!c)return E.emit("error",r||new Error("Archive read error"));let h=i.lastPos,l=h-i.win.position,u=i.win.buffer,f=i.minPos;for(;--h>=f&&--l>=0;)if(u.length-l>=4&&u[l]===i.firstByte&&u.readUInt32LE(l)===i.sig){i.lastBufferPosition=l,i.lastBytesRead=c,i.complete();return}if(h===f)return E.emit("error",new Error("Bad archive"));if(i.lastPos=h+1,i.chunkSize*=2,h<=f)return E.emit("error",new Error("Bad archive"));let m=Math.min(i.chunkSize,h-f);i.win.expandLeft(m,F)}function Le(){let r=Math.min(s.ENDHDR+s.MAXFILECOMMENT,t);i={win:new T(e),totalReadLength:r,minPos:t-r,lastPos:t,chunkSize:Math.min(1024,n),firstByte:s.ENDSIGFIRST,sig:s.ENDSIG,complete:Ie},i.win.read(t-i.chunkSize,i.chunkSize,F)}function Ie(){let r=i.win.buffer,c=i.lastBufferPosition;try{a=new B,a.read(r.slice(c,c+s.ENDHDR)),a.headerOffset=i.win.position+c,a.commentLength?E.comment=r.slice(c+s.ENDHDR,c+s.ENDHDR+a.commentLength).toString():E.comment=null,E.entriesCount=a.volumeEntries,E.centralDirectory=a,a.volumeEntries===s.EF_ZIP64_OR_16&&a.totalEntries===s.EF_ZIP64_OR_16||a.size===s.EF_ZIP64_OR_32||a.offset===s.EF_ZIP64_OR_32?we():(i={},$())}catch(h){E.emit("error",h)}}function we(){let r=s.ENDL64HDR;i.lastBufferPosition>r?(i.lastBufferPosition-=r,V()):(i={win:i.win,totalReadLength:r,minPos:i.win.position-r,lastPos:i.win.position,chunkSize:i.chunkSize,firstByte:s.ENDL64SIGFIRST,sig:s.ENDL64SIG,complete:V},i.win.read(i.lastPos-i.chunkSize,i.chunkSize,F))}function V(){let r=i.win.buffer,c=new G;c.read(r.slice(i.lastBufferPosition,i.lastBufferPosition+s.ENDL64HDR));let h=t-c.headerOffset;i={win:i.win,totalReadLength:h,minPos:c.headerOffset,lastPos:i.lastPos,chunkSize:i.chunkSize,firstByte:s.END64SIGFIRST,sig:s.END64SIG,complete:De},i.win.read(t-i.chunkSize,i.chunkSize,F)}function De(){let r=i.win.buffer,c=new H;c.read(r.slice(i.lastBufferPosition,i.lastBufferPosition+s.END64HDR)),E.centralDirectory.volumeEntries=c.volumeEntries,E.centralDirectory.totalEntries=c.totalEntries,E.centralDirectory.size=c.size,E.centralDirectory.offset=c.offset,E.entriesCount=c.volumeEntries,i={},$()}function $(){i={win:new T(e),pos:a.offset,chunkSize:n,entriesLeft:a.volumeEntries},i.win.read(i.pos,Math.min(n,t-i.pos),q)}function q(r,c){if(r||!c)return E.emit("error",r||new Error("Entries read error"));let h=i.pos-i.win.position,l=i.entry,u=i.win.buffer,f=u.length;try{for(;i.entriesLeft>0;){l||(l=new Z,l.readHeader(u,h),l.headerOffset=i.win.position+h,i.entry=l,i.pos+=s.CENHDR,h+=s.CENHDR);let m=l.fnameLen+l.extraLen+l.comLen,L=m+(i.entriesLeft>1?s.CENHDR:0);if(f-h<L){i.win.moveRight(n,q,h),i.move=!0;return}l.read(u,h,pe),o.skipEntryNameValidation||l.validateName(),C&&(C[l.name]=l),E.emit("entry",l),i.entry=l=null,i.entriesLeft--,i.pos+=m,h+=m}E.emit("ready")}catch(m){E.emit("error",m)}}function U(){if(!C)throw new Error("storeEntries disabled")}Object.defineProperty(this,"ready",{get(){return!1}}),this.entry=function(r){return U(),C[r]},this.entries=function(){return U(),C},this.stream=function(r,c){return this.openEntry(r,(h,l)=>{if(h)return c(h);let u=K(l),f=new k(e,u,l.compressedSize);if(l.method!==s.STORED)if(l.method===s.DEFLATED)f=f.pipe(te.createInflateRaw());else return c(new Error("Unknown compression method: "+l.method));Y(l)&&(f=f.pipe(new A(f,l.crc,l.size))),c(null,f)},!1)},this.entryDataSync=function(r){let c=null;if(this.openEntry(r,(l,u)=>{c=l,r=u},!0),c)throw c;let h=Buffer.alloc(r.compressedSize);if(new O(e,h,0,r.compressedSize,K(r),l=>{c=l}).read(!0),c)throw c;if(r.method!==s.STORED)if(r.method===s.DEFLATED||r.method===s.ENHANCED_DEFLATED)h=te.inflateRawSync(h);else throw new Error("Unknown compression method: "+r.method);if(h.length!==r.size)throw new Error("Invalid size");return Y(r)&&new P(r.crc,r.size).data(h),h},this.openEntry=function(r,c,h){if(typeof r=="string"&&(U(),r=C[r],!r))return c(new Error("Entry not found"));if(!r.isFile)return c(new Error("Entry is not file"));if(!e)return c(new Error("Archive closed"));let l=Buffer.alloc(s.LOCHDR);new O(e,l,0,l.length,r.offset,u=>{if(u)return c(u);let f;try{r.readDataHeader(l),r.encrypted&&(f=new Error("Entry encrypted"))}catch(m){f=m}c(f,r)}).read(h)};function K(r){return r.offset+s.LOCHDR+r.fnameLen+r.extraLen}function Y(r){return(r.flags&8)!==8}function z(r,c,h){E.stream(r,(l,u)=>{if(l)h(l);else{let f,m;u.on("error",L=>{m=L,f&&(u.unpipe(f),f.close(()=>{h(L)}))}),w.open(c,"w",(L,D)=>{if(L)return h(L);if(m){w.close(e,()=>{h(m)});return}f=w.createWriteStream(c,{fd:D}),f.on("finish",()=>{E.emit("extract",r,c),m||h()}),u.pipe(f)})}})}function J(r,c,h){if(!c.length)return h();let l=c.shift();l=b.join(r,b.join(...l)),w.mkdir(l,{recursive:!0},u=>{if(u&&u.code!=="EEXIST")return h(u);J(r,c,h)})}function M(r,c,h,l,u){if(!h.length)return l(null,u);let f=h.shift(),m=b.join(r,f.name.replace(c,""));z(f,m,L=>{if(L)return l(L,u);M(r,c,h,l,u+1)})}this.extract=function(r,c,h){let l=r||"";if(typeof r=="string"&&(r=this.entry(r),r?l=r.name:l.length&&l[l.length-1]!=="/"&&(l+="/")),!r||r.isDirectory){let u=[],f=[],m={};for(let L in C)if(Object.prototype.hasOwnProperty.call(C,L)&&L.lastIndexOf(l,0)===0){let D=L.replace(l,""),Q=C[L];if(Q.isFile&&(u.push(Q),D=b.dirname(D)),D&&!m[D]&&D!=="."){m[D]=!0;let S=D.split("/").filter(x=>x);for(S.length&&f.push(S);S.length>1;){S=S.slice(0,S.length-1);let x=S.join("/");if(m[x]||x===".")break;m[x]=!0,f.push(S)}}}f.sort((L,D)=>L.length-D.length),f.length?J(c,f,L=>{L?h(L):M(c,l,u,h,0)}):M(c,l,u,h,0)}else w.stat(c,(u,f)=>{f&&f.isDirectory()?z(r,b.join(c,b.basename(r.name)),h):z(r,c,h)})},this.close=function(r){d||!e?(d=!0,r&&r()):(d=!0,w.close(e,c=>{e=null,r&&r(c)}))};let ge=j.EventEmitter.prototype.emit;this.emit=function(...r){if(!d)return ge.call(this,...r)}};y.setFs=function(o){w=o};y.debugLog=(...o)=>{y.debug&&console.log(...o)};be.inherits(y,j.EventEmitter);var N=Symbol("zip");y.async=class extends j.EventEmitter{constructor(e){super();let t=new y(e);t.on("entry",n=>this.emit("entry",n)),t.on("extract",(n,i)=>this.emit("extract",n,i)),this[N]=new Promise((n,i)=>{t.on("ready",()=>{t.removeListener("error",i),n(t)}),t.on("error",i)})}get entriesCount(){return this[N].then(e=>e.entriesCount)}get comment(){return this[N].then(e=>e.comment)}async entry(e){return(await this[N]).entry(e)}async entries(){return(await this[N]).entries()}async stream(e){let t=await this[N];return new Promise((n,i)=>{t.stream(e,(a,d)=>{a?i(a):n(d)})})}async entryData(e){let t=await this.stream(e);return new Promise((n,i)=>{let a=[];t.on("data",d=>a.push(d)),t.on("end",()=>{n(Buffer.concat(a))}),t.on("error",d=>{t.removeAllListeners("end"),i(d)})})}async extract(e,t){let n=await this[N];return new Promise((i,a)=>{n.extract(e,t,(d,I)=>{d?a(d):i(I)})})}async close(){let e=await this[N];return new Promise((t,n)=>{e.close(i=>{i?n(i):t()})})}};var B=class{read(e){if(e.length!==s.ENDHDR||e.readUInt32LE(0)!==s.ENDSIG)throw new Error("Invalid central directory");this.volumeEntries=e.readUInt16LE(s.ENDSUB),this.totalEntries=e.readUInt16LE(s.ENDTOT),this.size=e.readUInt32LE(s.ENDSIZ),this.offset=e.readUInt32LE(s.ENDOFF),this.commentLength=e.readUInt16LE(s.ENDCOM)}},G=class{read(e){if(e.length!==s.ENDL64HDR||e.readUInt32LE(0)!==s.ENDL64SIG)throw new Error("Invalid zip64 central directory locator");this.headerOffset=_(e,s.ENDSUB)}},H=class{read(e){if(e.length!==s.END64HDR||e.readUInt32LE(0)!==s.END64SIG)throw new Error("Invalid central directory");this.volumeEntries=_(e,s.END64SUB),this.totalEntries=_(e,s.END64TOT),this.size=_(e,s.END64SIZ),this.offset=_(e,s.END64OFF)}},Z=class{readHeader(e,t){if(e.length<t+s.CENHDR||e.readUInt32LE(t)!==s.CENSIG)throw new Error("Invalid entry header");this.verMade=e.readUInt16LE(t+s.CENVEM),this.version=e.readUInt16LE(t+s.CENVER),this.flags=e.readUInt16LE(t+s.CENFLG),this.method=e.readUInt16LE(t+s.CENHOW);let n=e.readUInt16LE(t+s.CENTIM),i=e.readUInt16LE(t+s.CENTIM+2);this.time=ie(n,i),this.crc=e.readUInt32LE(t+s.CENCRC),this.compressedSize=e.readUInt32LE(t+s.CENSIZ),this.size=e.readUInt32LE(t+s.CENLEN),this.fnameLen=e.readUInt16LE(t+s.CENNAM),this.extraLen=e.readUInt16LE(t+s.CENEXT),this.comLen=e.readUInt16LE(t+s.CENCOM),this.diskStart=e.readUInt16LE(t+s.CENDSK),this.inattr=e.readUInt16LE(t+s.CENATT),this.attr=e.readUInt32LE(t+s.CENATX),this.offset=e.readUInt32LE(t+s.CENOFF)}readDataHeader(e){if(e.readUInt32LE(0)!==s.LOCSIG)throw new Error("Invalid local header");this.version=e.readUInt16LE(s.LOCVER),this.flags=e.readUInt16LE(s.LOCFLG),this.method=e.readUInt16LE(s.LOCHOW);let t=e.readUInt16LE(s.LOCTIM),n=e.readUInt16LE(s.LOCTIM+2);this.time=ie(t,n),this.crc=e.readUInt32LE(s.LOCCRC)||this.crc;let i=e.readUInt32LE(s.LOCSIZ);i&&i!==s.EF_ZIP64_OR_32&&(this.compressedSize=i);let a=e.readUInt32LE(s.LOCLEN);a&&a!==s.EF_ZIP64_OR_32&&(this.size=a),this.fnameLen=e.readUInt16LE(s.LOCNAM),this.extraLen=e.readUInt16LE(s.LOCEXT)}read(e,t,n){let i=e.slice(t,t+=this.fnameLen);this.name=n?n.decode(new Uint8Array(i)):i.toString("utf8");let a=e[t-1];this.isDirectory=a===47||a===92,this.extraLen&&(this.readExtra(e,t),t+=this.extraLen),this.comment=this.comLen?e.slice(t,t+this.comLen).toString():null}validateName(){if(/\\|^\w+:|^\/|(^|\/)\.\.(\/|$)/.test(this.name))throw new Error("Malicious entry: "+this.name)}readExtra(e,t){let n,i,a=t+this.extraLen;for(;t<a;)n=e.readUInt16LE(t),t+=2,i=e.readUInt16LE(t),t+=2,s.ID_ZIP64===n&&this.parseZip64Extra(e,t,i),t+=i}parseZip64Extra(e,t,n){n>=8&&this.size===s.EF_ZIP64_OR_32&&(this.size=_(e,t),t+=8,n-=8),n>=8&&this.compressedSize===s.EF_ZIP64_OR_32&&(this.compressedSize=_(e,t),t+=8,n-=8),n>=8&&this.offset===s.EF_ZIP64_OR_32&&(this.offset=_(e,t),t+=8,n-=8),n>=4&&this.diskStart===s.EF_ZIP64_OR_16&&(this.diskStart=e.readUInt32LE(t))}get encrypted(){return(this.flags&s.FLG_ENTRY_ENC)===s.FLG_ENTRY_ENC}get isFile(){return!this.isDirectory}},O=class{constructor(e,t,n,i,a,d){this.fd=e,this.buffer=t,this.offset=n,this.length=i,this.position=a,this.callback=d,this.bytesRead=0,this.waiting=!1}read(e){y.debugLog("read",this.position,this.bytesRead,this.length,this.offset),this.waiting=!0;let t;if(e){let n=0;try{n=w.readSync(this.fd,this.buffer,this.offset+this.bytesRead,this.length-this.bytesRead,this.position+this.bytesRead)}catch(i){t=i}this.readCallback(e,t,t?n:null)}else w.read(this.fd,this.buffer,this.offset+this.bytesRead,this.length-this.bytesRead,this.position+this.bytesRead,this.readCallback.bind(this,e))}readCallback(e,t,n){if(typeof n=="number"&&(this.bytesRead+=n),t||!n||this.bytesRead===this.length)return this.waiting=!1,this.callback(t,this.bytesRead);this.read(e)}},T=class{constructor(e){this.position=0,this.buffer=Buffer.alloc(0),this.fd=e,this.fsOp=null}checkOp(){if(this.fsOp&&this.fsOp.waiting)throw new Error("Operation in progress")}read(e,t,n){this.checkOp(),this.buffer.length<t&&(this.buffer=Buffer.alloc(t)),this.position=e,this.fsOp=new O(this.fd,this.buffer,0,t,this.position,n).read()}expandLeft(e,t){this.checkOp(),this.buffer=Buffer.concat([Buffer.alloc(e),this.buffer]),this.position-=e,this.position<0&&(this.position=0),this.fsOp=new O(this.fd,this.buffer,0,e,this.position,t).read()}expandRight(e,t){this.checkOp();let n=this.buffer.length;this.buffer=Buffer.concat([this.buffer,Buffer.alloc(e)]),this.fsOp=new O(this.fd,this.buffer,n,e,this.position+n,t).read()}moveRight(e,t,n){this.checkOp(),n?this.buffer.copy(this.buffer,0,n):n=0,this.position+=n,this.fsOp=new O(this.fd,this.buffer,this.buffer.length-n,n,this.position+this.buffer.length-n,t).read()}},k=class extends re.Readable{constructor(e,t,n){super(),this.fd=e,this.offset=t,this.length=n,this.pos=0,this.readCallback=this.readCallback.bind(this)}_read(e){let t=Buffer.alloc(Math.min(e,this.length-this.pos));t.length?w.read(this.fd,t,0,t.length,this.offset+this.pos,this.readCallback):this.push(null)}readCallback(e,t,n){this.pos+=t,e?(this.emit("error",e),this.push(null)):t?(t!==n.length&&(n=n.slice(0,t)),this.push(n)):this.push(null)}},A=class extends re.Transform{constructor(e,t,n){super(),this.verify=new P(t,n),e.on("error",i=>{this.emit("error",i)})}_transform(e,t,n){let i;try{this.verify.data(e)}catch(a){i=a}n(i,e)}},P=class o{constructor(e,t){this.crc=e,this.size=t,this.state={crc:-1,size:0}}data(e){let t=o.getCrcTable(),n=this.state.crc,i=0,a=e.length;for(;--a>=0;)n=t[(n^e[i++])&255]^n>>>8;if(this.state.crc=n,this.state.size+=e.length,this.state.size>=this.size){let d=Buffer.alloc(4);if(d.writeInt32LE(~this.state.crc&4294967295,0),n=d.readUInt32LE(0),n!==this.crc)throw new Error("Invalid CRC");if(this.state.size!==this.size)throw new Error("Invalid size")}}static getCrcTable(){let e=o.crcTable;if(!e){o.crcTable=e=[];let t=Buffer.alloc(4);for(let n=0;n<256;n++){let i=n;for(let a=8;--a>=0;)i&1?i=3988292384^i>>>1:i=i>>>1;i<0&&(t.writeInt32LE(i,0),i=t.readUInt32LE(0)),e[n]=i}}return e}};function ie(o,e){let t=ne(o,16),n=ne(e,16),i={h:parseInt(t.slice(0,5).join(""),2),m:parseInt(t.slice(5,11).join(""),2),s:parseInt(t.slice(11,16).join(""),2)*2,Y:parseInt(n.slice(0,7).join(""),2)+1980,M:parseInt(n.slice(7,11).join(""),2),D:parseInt(n.slice(11,16).join(""),2)},a=[i.Y,i.M,i.D].join("-")+" "+[i.h,i.m,i.s].join(":")+" GMT+0";return new Date(a).getTime()}function ne(o,e){let t=(o>>>0).toString(2);for(;t.length<e;)t="0"+t;return t.split("")}function _(o,e){return o.readUInt32LE(e+4)*4294967296+o.readUInt32LE(e)}se.exports=y});var g=v(require("node:fs")),ce=v(require("node:http")),le=v(require("node:https")),R=v(require("node:path")),he=v(oe()),p=require("electron"),ae={slug:"",repo:"",branch:"",save_folder:""};function X(o){return new Promise((e,t)=>{let i=(o.startsWith("https")?le.default:ce.default).get(o);i.on("error",a=>t(a)),i.on("response",a=>{if(a.statusCode&&a.headers.location&&a.statusCode>=300&&a.statusCode<=399)return e(X(a.headers.location));let d=[];a.on("error",I=>t(I)),a.on("data",I=>d.push(I)),a.on("end",()=>{let I=Buffer.concat(d);e({data:I,str:I.toString("utf-8"),url:a.url})})})})}async function fe(o,e,t=""){let n=t||LiteLoader.plugins.pluginStore.path.data,i=(await X(o)).data,a=R.default.join(n,`${e}.zip`);return g.default.mkdirSync(n,{recursive:!0}),g.default.writeFileSync(a,i),a}async function xe(o,e,t=""){let n=t||LiteLoader.plugins.pluginStore.path.data,i=(await X(o)).data,a=R.default.join(n,e);return g.default.mkdirSync(n,{recursive:!0}),g.default.writeFileSync(a,i),a}async function ue(o,e){let{plugins:t}=LiteLoader.path,n=`${t}/${e}`;try{g.default.mkdirSync(n,{recursive:!0});let i=new he.default.async({file:o}),a=await i.entries(),d=!a.hasOwnProperty("manifest.json");for(let I of Object.values(a))if(!I.name.includes(".github")){let E=`${n}/${d?I.name.split("/").slice(1).join("/"):I.name}`;if(I.isDirectory){g.default.mkdirSync(E,{recursive:!0});continue}try{if(I.isFile){await i.extract(I.name,E);continue}}catch{g.default.mkdirSync(E.slice(0,E.lastIndexOf("/")),{recursive:!0}),await i.extract(I.name,E);continue}}return await i.close(),{status:!0,message:"\u5B89\u88C5\u6210\u529F"}}catch(i){return p.dialog.showErrorBox("\u63D2\u4EF6\u5546\u5E97",i.stack||i.message),g.default.rmSync(n,{recursive:!0,force:!0}),i.message.includes("Bad archive")?{status:!1,message:"\u5B89\u88C5\u5305\u5F02\u5E38\uFF0C\u53EF\u80FD\u662F\u4F5C\u8005\u672A\u6B63\u786E\u914D\u7F6E"}:{status:!1,message:"\u5B89\u88C5\u5931\u8D25"}}}async function ve(o,e){try{let t=await fe(o,e);return await ue(t,e)}catch(t){return{status:!1,message:t.stack||t.message}}}async function Ee(o,e=!1){let t=LiteLoader.plugins[o].path;if(!t)return!1;if(e)return g.default.rmSync(t.plugin,{recursive:!0,force:!0}),!0;for(let[n,i]of Object.entries(t))g.default.rmSync(i,{recursive:!0,force:!0});return!0}async function Fe(o,e){try{let t=await fe(o,e);return await Ee(e,!0)?(await ue(t,e)).status?{status:!0,message:"\u66F4\u65B0\u6210\u529F"}:{status:!1,message:"\u66F4\u65B0\u5931\u8D25"}:{status:!1,message:"\u66F4\u65B0\u5931\u8D25"}}catch(t){return{status:!1,message:t.stack||t.message}}}async function Te(){p.app.relaunch(),p.app.exit(0)}function Pe(){p.ipcMain.handle("LiteLoader.pluginStore.install",(o,...e)=>ve(e[0],e[1])),p.ipcMain.handle("LiteLoader.pluginStore.downloadFile",async(o,...e)=>{try{return await xe(e[0],e[1],e[2]),"\u4E0B\u8F7D\u6210\u529F"}catch(t){return p.dialog.showErrorBox("\u63D2\u4EF6\u5546\u5E97",t.stack||t.message),"\u4E0B\u8F7D\u5931\u8D25"}}),p.ipcMain.handle("LiteLoader.pluginStore.uninstall",(o,...e)=>Ee(e[0],e[1])),p.ipcMain.handle("LiteLoader.pluginStore.update",(o,...e)=>Fe(e[0],e[1])),p.ipcMain.handle("LiteLoader.pluginStore.restart",()=>Te()),p.ipcMain.on("LiteLoader.pluginStore.openWeb",(o,e)=>p.shell.openExternal(e)),p.ipcMain.on("LiteLoader.pluginStore.createWin",(o,e)=>{let t=setInterval(()=>{p.BrowserWindow.getAllWindows().forEach(n=>{n.webContents.getURL().includes("#/setting/settings/common")&&(clearInterval(t),n.webContents.send("message-main",e))})},100);setTimeout(()=>clearInterval(t),1500)}),p.ipcMain.on("LiteLoader.pluginStore.createBrowserWindow",(o,e)=>{ae=JSON.parse(e);let t=process.env.NODE_ENV==="development"?R.default.join(__dirname,"..","preload","index.js"):R.default.join(__dirname,"preload.js"),n=new p.BrowserWindow({transparent:!1,backgroundColor:"#ffffff",titleBarStyle:"default",trafficLightPosition:{x:5,y:5},visualEffectState:"active",autoHideMenuBar:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:t,additionalArguments:["--fetch-schemes=local"],devTools:!0,plugins:!0,sandbox:!0,webviewTag:!0,webSecurity:!1}});n.webContents.on("before-input-event",async(a,d)=>{d.key==="F12"&&d.type==="keyUp"&&(n.webContents.isDevToolsOpened()?n.webContents.closeDevTools():n.webContents.openDevTools())}),process.env.NODE_ENV==="development"?n.loadURL("http://localhost:5173/store/"):n.loadFile(R.default.join(__dirname,"view/index.html"));let i=n.webContents.session.protocol;i.isProtocolHandled("local")||i.handle("local",async a=>{let{host:d,pathname:I}=new URL(decodeURI(a.url)),E=R.default.normalize(I.slice(1));return p.net.fetch(`file://${d}/${E}`)}),n.on("closed",()=>{})}),p.ipcMain.on("LiteLoader.pluginStore.getStoreData",o=>{o.returnValue=ae}),p.ipcMain.on("LiteLoader.pluginStore.log",(o,e,...t)=>{let i={0:"debug",1:"log",2:"info",3:"warn",4:"error"}[e]||"log";console[i](`[!Renderer:Log:${o.sender.id}]`,...t)})}Pe();
/*! Bundled license information:

node-stream-zip/node_stream_zip.js:
  (**
   * @license node-stream-zip | (c) 2020 Antelle | https://github.com/antelle/node-stream-zip/blob/master/LICENSE
   * Portions copyright https://github.com/cthackers/adm-zip | https://raw.githubusercontent.com/cthackers/adm-zip/master/LICENSE
   *)
*/
